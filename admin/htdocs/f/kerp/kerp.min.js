console.dir(KISP),function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){var A=function(){function a(a,b){e[a]={required:!1,exports:b,exposed:!1}}function b(a){var c=e[a];if(c){var d=c.exports;if(c.required)return d;if("function"==typeof d){var f=d;d={};var g={id:a,exports:d},h=f(b,g,d);d=h===z?g.exports:h,c.exports=d}return c.required=!0,d}}function c(a,c){var d=b(a);if(d){var f=e[a].exposed;return void(c&&c(f?d:null))}var g=b("$"),h=b("Url"),i=h.format("{~}lib/kerp/{0}.{@}.js",a);g.Script.load(i,function(){d=b(a);var f=e[a].exposed;c&&c(f?d:null)})}function d(a,b){function c(a){var b=e[a];return b?b.exposed:!1}function d(a,b){var c=e[a];c&&(c.exposed=!!b)}return"object"==typeof a?void m.Object.each(a,function(a,b){d(a,b)}):2==arguments.length?void d(a,b):c(a)}var e={};return{define:a,require:b,async:c,expose:d}}(),B=A.define,C=A.require;B("$",function(){return m}),B("MiniQuery",function(){return o}),B("API",function(a){function b(a){try{return d.JSON.parse(a)}catch(b){}try{return a=a.replace(/^(\r\n)+/g,""),new t("return "+a)()}catch(b){}return null}function c(a){if(!h.request(a)){var c=m.url+a.name+".do",d=(a.method||"get").toLowerCase(),e=a.data||null;if(e)if(e=f.Object.map(e,function(a,b){return"object"==typeof b&&b?f.Object.toJson(b):b}),e=f.Object.toQueryString(e),"get"==d)c+="?"+e,e=null;else{var g=a.query;g&&(g=f.Object.toQueryString(g),c+="?"+g)}var i=new XMLHttpRequest;i.open(d,c,!0),i.onreadystatechange=function(){if(4==i.readyState){var c=m.codes.success,d=a.error;if(i.status!=c)return void(d&&d(i));var e=b(i.responseText);if(!e)return void(d&&d(i));var f=e.code;if(f==c){var g=a.success;g&&g(e.data||{},e,i)}else{var h=a.fail;h&&h(f,e.msg,e,i)}}},"post"==d&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e)}}function e(a,b){"object"==typeof a&&(b=a,a=b.name),b=b||{},this[l]="API-"+f.String.random();var c=m.codes,d=new j(this),e={name:a,data:b.data,query:b.query,status:"",args:[],emitter:d};k.set(this,e),f.Object.extend(e,{fireEvent:function(a,b){a=e.status=a||e.status,b=e.args=b||e.args,d.fire("done",b),d.fire(a,b),"success"==a?d.fire(c.success,b):"fail"==a&&d.fire(b.shift(),b)},success:function(a,b,c){e.fireEvent("success",[a,b,c])},fail:function(a,b,c,d){e.fireEvent("fail",[a,b,c,d])},error:function(a){e.fireEvent("error",[a])}});var g=this;f.Array.each(["done","success","fail","error",c.success],function(a){a=a.toString();var c=b[a];c&&g.on(a,c)})}var f=a("$"),g=a("MiniQuery"),h=a("Proxy"),i=g.require("Mapper"),j=g.require("Emitter"),k=new i,l=i.getGuidKey(),m={};return e.prototype={constructor:e,get:function(a){var b=k.get(this);return c({method:"get",name:b.name,data:a||b.data,success:b.success,fail:b.fail,error:b.error}),this},post:function(a,b){var d=k.get(this);return c({method:"post",name:d.name,data:a||d.data,query:b||d.query,success:d.success,fail:d.fail,error:d.error}),this},done:function(a){return this.on("done",a),this},success:function(a){return this.on("success",a),this},fail:function(a){return this.on("fail",a),this},error:function(a){return this.on("error",a),this},on:function(){var a=k.get(this),b=a.emitter,c=[].slice.call(arguments,0);return b.on.apply(b,c),a.status&&a.fireEvent(),this},off:function(){var a=k.get(this),b=a.emitter,c=[].slice.call(arguments,0);return b.off.apply(b,c),this}},f.Object.extend(e,{ajax:c,config:function(a){f.Object.extend(m,a)}})}),B("Proxy",function(a){function b(a){try{return d.JSON.parse(a)}catch(b){try{return a=a.replace(/^(\r\n)+/g,""),new t("return "+a)()}catch(b){return null}}return null}function c(a){if(a){var b=[].slice.call(arguments,1),c=i.Math.randomInt(500,3e3);k(function(){a.apply(null,b)},c)}}function e(a){var d=a.name,e=n[d];if(e instanceof p&&(e=e.pop()),!e)return!1;if(m.isJs(e)){var f=j.check(e)?e:j.root()+e;return f=i.require("Url").randomQueryString(f),o[f]=a,l.use(f,function(b){if(!b)return void c(a.error);var d=b.code;200==d?c(a.success,b.data||{},b):c(a.fail,d,b.msg,b)}),!0}e===!0&&(e=d+".json");var f=j.root()+e+"?r="+u.random(),g=new XMLHttpRequest;return g.open("get",f,!0),g.onreadystatechange=function(){if(4==g.readyState){if(200!=g.status)return void c(a.error);var d=b(g.responseText);if(!d)return void c(a.error);var e=d.code;200==e?c(a.success,d.data||{},d):c(a.fail,e,d.msg,d)}},g.send(null),!0}function f(a,b){d.seajs.Module.define(function(c,d,e){var f=h(e),g=f.data;if(i.Object.isPlain(a))return a;var j="function"==typeof a?a:b[g[a]];return j?j(g,f)||{}:{}})}function g(a){return a?void i.Object.extend(n,a):i.Object.extend({},n)}function h(a){"object"==typeof a&&(a=a.uri);var b=o[a];return delete o[a],b}var i=a("$"),j=a("Url"),l=(a("Debug"),a("Seajs")),m=a("File"),n={},o={};return{request:e,response:f,config:g}}),B("MD5",function(){function a(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var h=1732584193,i=-271733879,j=-1732584194,k=271733878,l=0;l<a.length;l+=16){var m=h,n=i,o=j,q=k;h=c(h,i,j,k,a[l+0],7,-680876936),k=c(k,h,i,j,a[l+1],12,-389564586),j=c(j,k,h,i,a[l+2],17,606105819),i=c(i,j,k,h,a[l+3],22,-1044525330),h=c(h,i,j,k,a[l+4],7,-176418897),k=c(k,h,i,j,a[l+5],12,1200080426),j=c(j,k,h,i,a[l+6],17,-1473231341),i=c(i,j,k,h,a[l+7],22,-45705983),h=c(h,i,j,k,a[l+8],7,1770035416),k=c(k,h,i,j,a[l+9],12,-1958414417),j=c(j,k,h,i,a[l+10],17,-42063),i=c(i,j,k,h,a[l+11],22,-1990404162),h=c(h,i,j,k,a[l+12],7,1804603682),k=c(k,h,i,j,a[l+13],12,-40341101),j=c(j,k,h,i,a[l+14],17,-1502002290),i=c(i,j,k,h,a[l+15],22,1236535329),h=d(h,i,j,k,a[l+1],5,-165796510),k=d(k,h,i,j,a[l+6],9,-1069501632),j=d(j,k,h,i,a[l+11],14,643717713),i=d(i,j,k,h,a[l+0],20,-373897302),h=d(h,i,j,k,a[l+5],5,-701558691),k=d(k,h,i,j,a[l+10],9,38016083),j=d(j,k,h,i,a[l+15],14,-660478335),i=d(i,j,k,h,a[l+4],20,-405537848),h=d(h,i,j,k,a[l+9],5,568446438),k=d(k,h,i,j,a[l+14],9,-1019803690),j=d(j,k,h,i,a[l+3],14,-187363961),i=d(i,j,k,h,a[l+8],20,1163531501),h=d(h,i,j,k,a[l+13],5,-1444681467),k=d(k,h,i,j,a[l+2],9,-51403784),j=d(j,k,h,i,a[l+7],14,1735328473),i=d(i,j,k,h,a[l+12],20,-1926607734),h=e(h,i,j,k,a[l+5],4,-378558),k=e(k,h,i,j,a[l+8],11,-2022574463),j=e(j,k,h,i,a[l+11],16,1839030562),i=e(i,j,k,h,a[l+14],23,-35309556),h=e(h,i,j,k,a[l+1],4,-1530992060),k=e(k,h,i,j,a[l+4],11,1272893353),j=e(j,k,h,i,a[l+7],16,-155497632),i=e(i,j,k,h,a[l+10],23,-1094730640),h=e(h,i,j,k,a[l+13],4,681279174),k=e(k,h,i,j,a[l+0],11,-358537222),j=e(j,k,h,i,a[l+3],16,-722521979),i=e(i,j,k,h,a[l+6],23,76029189),h=e(h,i,j,k,a[l+9],4,-640364487),k=e(k,h,i,j,a[l+12],11,-421815835),j=e(j,k,h,i,a[l+15],16,530742520),i=e(i,j,k,h,a[l+2],23,-995338651),h=f(h,i,j,k,a[l+0],6,-198630844),k=f(k,h,i,j,a[l+7],10,1126891415),j=f(j,k,h,i,a[l+14],15,-1416354905),i=f(i,j,k,h,a[l+5],21,-57434055),h=f(h,i,j,k,a[l+12],6,1700485571),k=f(k,h,i,j,a[l+3],10,-1894986606),j=f(j,k,h,i,a[l+10],15,-1051523),i=f(i,j,k,h,a[l+1],21,-2054922799),h=f(h,i,j,k,a[l+8],6,1873313359),k=f(k,h,i,j,a[l+15],10,-30611744),j=f(j,k,h,i,a[l+6],15,-1560198380),i=f(i,j,k,h,a[l+13],21,1309151649),h=f(h,i,j,k,a[l+4],6,-145523070),k=f(k,h,i,j,a[l+11],10,-1120210379),j=f(j,k,h,i,a[l+2],15,718787259),i=f(i,j,k,h,a[l+9],21,-343485551),h=g(h,m),i=g(i,n),j=g(j,o),k=g(k,q)}return p(h,i,j,k)}function b(a,b,c,d,e,f){return g(h(g(g(b,a),g(d,f)),e),c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function h(a,b){return a<<b|a>>>32-b}function i(a){for(var b=p(),c=(1<<l)-1,d=0;d<a.length*l;d+=l)b[d>>5]|=(a.charCodeAt(d/l)&c)<<d%32;return b}function j(a){for(var b=k?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c}var k=0,l=8;return{encrypt:function(b){return arguments.length>1&&(b=[].slice.call(arguments,0).join("")),j(a(i(b),b.length*l))}}}),B("Cache",function(){function a(a,b){return a in g?g[a]:(g[a]=b,b)}function c(a,b){g[a]=b}function e(a){delete g[a]}function f(a){return a in g}if(d!==b)return b.KERP.require("Cache");var g={};return{get:a,set:c,remove:e,has:f}}),B("Config",function(a){function b(a){return d.Object.map(a,function(a,c){return"string"==typeof c?e.format(c):c instanceof p?d.Array.keep(c,function(a){return"string"==typeof a?e.format(a):"object"==typeof a?b(a):a},!0):c},!0)}function c(c){var f=c.Url;f&&e.config(f),d.Object.each(c,function(c,d){if("Url"!=c){var e=a(c);e&&e.config&&(d=b(d),e.config(d))}})}var d=a("$"),e=a("Url");return{set:c}}),B("Debug",function(a){function b(a){g=!!a}function c(){var a=g?"debug":"min";return h[a]}function d(){return g}function e(a){f.Object.extend(h,a)}var f=a("$"),g=!0,h={debug:"debug",min:"min"};return{set:b,get:c,check:d,config:e}}),B("File",function(){function a(a,b){return"string"!=typeof a||"string"!=typeof b?!1:a.slice(0-b.length).toLowerCase()==b.toLowerCase()}function b(b){return a(b,".js")}function c(b){return a(b,".css")}function d(b){return a(b,".json")}return{is:a,isJs:b,isCss:c,isJson:d}}),B("Module",function(a,b){function c(a){return d.Object.findKey(f,function(b,c){return c===a})}var d=a("$"),e={},f={};b.exports={define:function(a,b){e[a]={required:!1,exports:b,exposed:!1},f[a]=b},require:function(a){if(0==a.indexOf("/")){var b=c(arguments.callee.caller);if(!b)throw new s('require 时如果指定了以 "/" 开头的短名称，则必须用在 define 的函数体内');a=b+a}var d=e[a];if(d){var f=arguments.callee,g=d.exports;if(d.required)return g;if("function"==typeof g){var h=g;g={};var i={id:a,exports:g},j=h(f,i,g);g=j===z?i.exports:j,d.exports=g}return d.required=!0,g}}}}),B("Multitask",function(a){function b(a){return f.Array.keep(a,function(){return!1})}function c(a,b){var c=a&&a.length>0;c&&(f.Array.each(a,function(a){return a?void 0:(c=!1,!1)}),c&&b&&b(a))}function d(a,d){var e=b(a);f.Array.each(a,function(a,b){if("function"==typeof a)a(function(a){e[b]=a,c(e,d)});else{var f=a.fn,g=a.args||[],h=a.context||null;g.push(function(a){e[b]=a,c(e,d)}),f.apply(h,g)}})}function e(a,c){var d=b(a),e=0,f=a.length;!function(){var b=arguments.callee,g=a[e];g(function(a){d[e]=a,e++,f>e?b():c&&c(d)})}()}var f=a("$");return{concurrency:d,serial:e}}),B("Seajs",function(a){function b(a){if(i)return void(a&&a(i));var b=g.format("{~}lib/seajs/seajs.mod.{@}.js");f.require("Script").load({url:b,id:"seajsnode",onload:function(){i=d.seajs,i.config(h),a&&a(i)}})}function c(){var a=[].slice.call(arguments,0);b(function(b){b.use.apply(b,a)})}function e(a){f.Object.extend(h,a),i&&i.config(h)}var f=a("$"),g=a("Url"),h=(a("Debug"),{}),i=d.seajs;return{ready:b,use:c,config:e}}),B("Tree",function(a){function b(a,c,d){if(a instanceof p){var e=j.keep(a,function(a){return b(a,c,d)});return j.reduceDimension(e)}var f=a[c];if(!f||!f.length)return d&&d(a),a;var e=j.keep(f,function(a){return b(a,c,d)});return e=j.reduceDimension(e),d&&d(a,f),[a].concat(e)}function c(a,b,d){a instanceof p&&j.each(a,function(a){c(a,b,d)});var e=a[b];return e&&e.length?(j.each(e,function(a){c(a,b,d)}),void(d&&d(a,e))):void(d&&d(a))}function d(a,b){if(a instanceof p&&b instanceof p){var c=b.length;if(a.length!=c)return!1;for(var d=0;c>d;d++){var e=a[d];if(!(m in e))return!1;var f=b[d];if(!(m in f))return!1;if(e[m]!=f[m])return!1}return!0}return m in a&&m in b?a[m]==b[m]:!1}function e(a,b){this[m]=k.random();var c={},d={},e={data:a,childKey:b.childKey,valueKey:b.valueKey,id$node:c,id$info:d};l.set(this,e),this.each(function(a,b){var e=k.random();c[e]=a,a[m]=e;var f=d[e]={isLeaf:!b||!b.length||b.length<0,parentId:null,ids:[]};b&&(f.ids=j.keep(b,function(a){var b=a[m],c=d[b];return c.parentId=e,b}))})}var f=a("$"),g=a("MiniQuery"),h=g.require("Mapper"),i=f.Object,j=f.Array,k=f.String,l=new h,m=h.getGuidKey();return e.prototype={constructor:e,linearize:function(a){var c=l.get(this),d=c.data,e=c.childKey,f=b(d,e,a);return f},each:function(a){var b=l.get(this),d=b.data,e=b.childKey;c(d,e,a)},has:function(a){if(!(m in a))return!1;var b=l.get(this),c=b.id$info,d=a[m],e=c[d];return!!e},isLeaf:function(a){if(!this.has(a))throw new s("该节点不属于本树实例对象。");var b=l.get(this),c=b.id$info,d=a[m];return c[d].isLeaf},getParents:function(a){if(!this.has(a))return null;var b=l.get(this),c=b.id$node,d=b.id$info,e=[];do{e.push(a);var f=a[m],g=d[f],h=g.parentId;a=c[h]}while(a);return e.reverse(),e},getChildren:function(a){if(!this.has(a))return null;var b=l.get(this),c=b.id$node,d=b.id$info,e=a[m],f=d[e];return j.keep(f.ids,function(a){return c[a]})},getItemsByValues:function(a){var b=l.get(this),c=b.data,d=[c];if(!a||!a.length)return d;var e=b.id$node,f=b.id$info,g=b.valueKey,h=c,i=j.map(a,function(a){var b=h[m],c=f[b],d=c.ids;return d&&d.length&&(b=j.findItem(d,function(b){var c=e[b];return c[g]===a}))?h=e[b]:void 0});return d.concat(i)},getItemsByIndexes:function(a){var b=l.get(this),c=b.data,d=[c];if(!a||!a.length)return d;var e=b.id$node,f=b.id$info,g=c,h=j.map(a,function(a){var b=g[m],c=f[b],d=c.ids;return d&&d.length&&(b=d[a])?g=e[b]:void 0});return d.concat(h)},destroy:function(){l.remove(this)}},i.extend(e,{linearize:b,each:c,same:d})}),B("Url",function(a){function b(){return h[i]||h["default"]}function c(a){return a?void g.Object.extend(h,a):g.Object.extend({},h)}function d(a){return"string"!=typeof a?!1:0==a.indexOf("http://")||0==a.indexOf("https://")}function e(c,d){var e=a("Debug");if("object"!=typeof d){var f=[].slice.call(arguments,1);d=g.Array.toObject(f),delete d.length}return d=g.Object.extend({"~":b(),"@":e.get()},d),g.String.format(c,d)}var g=a("$"),h={},i=f.host;return g.Object.extend({},{root:b,config:c,check:d,format:e})}),B("Dialog",function(a){function c(a){h.use("dialog",a)}function e(a){return 0==arguments.length?i:void g.Object.extend(i,a)}function f(a,b){var c=k[b];if(c)return j+a+"-"+c}if(d!==b)return b.KERP.require("Dialog");var g=a("$"),h=a("Seajs"),i={},j="dialog-"+g.String.random()+"-",k={dialog:"dialog",data:"data"};return{use:c,config:e,getKey:f}}),B("Iframe",function(a){function c(a){if(a){var c=e();return c?c[a]:z}if(p)return p;var f=b.KISP.require("$")("iframe").toArray();return p=k.Array.findItem(f,function(a){return a.contentDocument===d.document})}function e(){var a=c();if(!a)return null;var b=a.src;if(q)return k.Object.extend(q,{hash:k.Url.getHash(b),actived:k(a).hasClass("actived")});var d=a.contentDocument.location,e=d.origin+d.pathname,f=a.getAttribute("src"),g=l.require("Url");return q={type:a.getAttribute("data-type"),id:a.id,index:a.getAttribute("data-index"),src:b,originalSrc:f,path:f.split("?")[0],url:e,sn:a.getAttribute("data-sn"),query:g.getQueryString(b),hash:g.getHash(b),actived:k(a).hasClass("actived")}}function f(a,b,c){o.open(a,b,c)}function g(a){var b=c("sn"),d=o.getData(b);return d?0==arguments.length?d:d[a]:void 0}function h(a,b){var d=c("sn");if(1==arguments.length)return b=a,void o.setData(d,b);var e=o.getData(d)||{};e[a]=b,o.setData(d,e)}function i(a){var b=c("sn");if(0==arguments.length)return void o.removeData(b);var d=o.getData(b);d&&(delete d[a],o.setData(b,d))}function j(){var b=a("Dialog"),d=c("sn"),e=b.getKey(d,"dialog");return o.getData(e)}if(d===b)return a("IframeManager");var k=a("$"),l=a("MiniQuery"),m=l.require("Emitter"),n=new m,o=b.KERP.require("Iframe"),p=null,q=null;return{get:c,getInfos:e,getData:g,setData:h,removeData:i,getDialog:j,open:f,on:n.on.bind(n),fire:n.fire.bind(n)}}),B("IframeManager",function(a){function c(a){return l[a]}function d(a,b){l[a]=b}function e(a){delete l[a]}function f(a,b,c){var d=a+"-"+b;l[d]=c,k.fire("open",[a,b,c])}function g(a,c,d){if("object"==typeof c){var e=c;c=a,a=e.id,d=[e]}var f=b.KISP.require("$")('iframe[data-sn="'+a+'"]').get(0);if(!f)throw new s("不存在 sn 为 "+a+" 的 iframe 页面");var g=f.contentWindow.KERP;if(g){var i=g.require("Iframe").fire(c,d);return i?i[i.length-1]:z}h(f).one("load",function(){var a=f.contentWindow.KERP;a&&a.require("Iframe").fire(c,d)})}var h=a("$"),i=a("MiniQuery"),j=i.require("Emitter"),k=new j,l={};return{open:f,getData:c,setData:d,removeData:e,on:k.on.bind(k),fire:g,sn$data:l}}),B("Loading",function(a){function b(a){this[g]="Loading-"+c.String.random();var b=a.container,d=a.text||i.text,e={container:b,selector:a.selector,text:d,rendered:!1};f.set(this,e)}var c=a("$"),d=a("Samples"),e=o.require("Mapper"),f=new e,g=e.getGuidKey(),h=d.get("Loading"),i={};return b.prototype={constructor:b,render:function(){var a=f.get(this),b=c.String.format(h,{text:a.text});c(a.container).html(b),a.rendered=!0},show:function(){var a=f.get(this);a.rendered||this.render();var b=a.selector;b&&c(b).hide(),c(a.container).show()},hide:function(){var a=f.get(this),b=a.selector;b&&c(b).show(),c(a.container).hide()}},c.Object.extend(b,{create:function(a){var c=new b(a);return c.show(),c},config:function(a){c.Object.extend(i,a)}})}),B("Login",function(a){function c(a){var c=f(),e=!(!c||!c.userID);if(!e&&a){var g=b.location.href,h=t.files,i="/"+h.master,j="/"+h.login;if(b===d&&g.indexOf(i)<0){var k=g.split("/html/");g=k[0]+j}else g=g.replace(i,j);b.location.href=g}return e}function e(){n.use(function(a){function b(a){var b=a.find('[data-id="ok"]'),e=b.html();b.html("登录中...").attr("disabled",!0);var f=a.find('[data-field="msg"]').hide();h({user:c.value,password:d.value},function(){p.success("登录成功",2e3),a.close()},function(a,c){f.html(c).show(),b.html(e).attr("disabled",!1),d.value="",d.focus()},function(){f.html("网络繁忙，登录失败，请稍候再试!").show(),b.html(e).attr("disabled",!1),d.value="",d.focus()})}var c,d,e=f(),g=new a({width:240,height:100,skin:"login-box",title:"重新登录",content:j.String.format(s,{user:e?e.number||"":""}),okValue:"立即登录",ok:function(){return b(this),!1},onshow:function(){var a=this;c=this.find('[data-field="user"]').get(0),d=this.find('[data-field="password"]').get(0),j(c).on("keydown",function(c){13==c.keyCode&&b(a)}),j(d).on("keydown",function(c){13==c.keyCode&&b(a)})},onfocus:function(){k(function(){e?d.focus():c.focus()},100)}});g.showModal()})}function f(){var a=o.require("SessionStorage"),b=a.get(r);return b||null}function g(){var a=j.LocalStorage.get(r);return a||null}function h(a,b,c,d){var e=new l(t.api);e.get({action:t.actions.login,user:a.user,pwd:m.encrypt(a.password)}),e.on("success",function(a,c){var d=j.Object.extend({},a,{messageCount:a.messageCount||0,companyList:[]});j.SessionStorage.set(r,d),j.LocalStorage.set(r,d),b&&b(d,a,c)}),e.on({fail:c,error:d})}function i(a,b,c){var d=new l(t.api);d.on({fail:b,error:c}),d.get({action:t.actions.logout}),d.on("success",function(b,c){j.SessionStorage.remove(r);var d=f();a&&a(d,b,c)})}var j=a("$"),l=a("API"),m=a("MD5"),n=a("Dialog"),p=a("Tips"),q=a("Samples"),r="KERP.Login.user.F5F2BA55218E",s=q.get("Login"),t={};return{check:c,get:f,getLast:g,show:e,login:h,logout:i,config:function(a){j.Object.extend(t,a)}}}),B("Pager",function(a){function c(a,b,c,d){if("object"==typeof b){var e=b;b=e.from,c=e.to,d=e.more}var f=h.Array.pad(b,c+1),g=h.Array.keep(f,function(b){var c=b==a;return h.String.format(m.item,{no:b,active:c?"active":"","data-no":c?"":'data-no="'+b+'"'})}).join("");return d&&(g+=m.more),g}function d(a,b){return 10>=a?[{from:1,to:a,more:!1}]:3>=b?[{from:1,to:5,more:!0}]:5>=b?[{from:1,to:b+2,more:!0}]:b>=a-1?[{from:1,to:2,more:!0},{from:a-5,to:a,more:!1}]:[{from:1,to:2,more:!0},{from:b-2,to:b+2,more:b+2!=a}]}function f(a,b,c){if(1>=a)return a;if(b==a)return a-1;var d;return b>c?d=b+1:(d=b-1,1>d&&(d=2)),d}function g(a){function b(){var a=e.getElementById(o),b=a.value;r.to(b,!0)}var c=h.String.random().toLowerCase();this[l]="Pager-"+c;var d=a.container,f=a.current||1,g=a.size,j=a.total,m=u.ceil(j/g),n="ul-pager-"+c,o="txt-pager-"+c,p=new i.Event(this),q={ulId:n,txtId:o,container:d,current:f,size:g,count:m,hideIfLessThen:a.hideIfLessThen||0,emitter:p,last:0};k.set(this,q);var r=this;h.Array.each(["change","error"],function(b){var c=a[b];c&&r.on(b,c)});var s={no:"#"+n+" [data-no]",button:"#"+n+" [data-button]:not(.disabled)",txt:"#"+o};h(d).delegate(s.no,"click",function(){var a=this,b=+a.getAttribute("data-no");r.to(b,!0)}).delegate(s.button,"click",function(){var a=this,c=a.getAttribute("data-button");"to"==c?b():r[c](!0)}).delegate(s.txt,"keydown",function(a){13==a.keyCode&&b()})}var h=a("$"),i=a("MiniQuery"),j=i.require("Mapper"),k=new j,l=j.getGuidKey(),m=h.String.getTemplates(b.document.body.innerHTML,[{name:"ul",begin:"<!--Samples.Pager--!",end:"--Samples.Pager-->"},{name:"item",begin:"#--item.begin--#",end:"#--item.end--#",outer:"{items}"},{name:"more",begin:"#--more.begin--#",end:"#--more.end--#",outer:""}]);return g.prototype={constructor:g,render:function(){var a=k.get(this),b=a.count;if(b<a.hideIfLessThen)return void h(a.container).hide();var e=u.min(b,a.current),g=d(b,e),i=h.Array.keep(g,function(a){return c(e,a)}).join(""),j=f(b,e,a.last),l=h.String.format(m.ul,{"ul-id":a.ulId,"txt-id":a.txtId,current:e,count:b,toNo:j,"first-disabled-class":e==u.min(1,b)?"disabled":"","final-disabled-class":e==b?"disabled":"","jump-disabled-class":0==b?"disabled":"","txt-disabled":0==b?"disabled":"",items:i});h(a.container).html(l).show()},to:function(a,b){var c=k.get(this),d=c.emitter,e=/^\d+$/.test(a);if(!e)return void(b&&d.fire("error",["输入的页码必须是大于 0 的数字"]));a=parseInt(a);var f=c.count;return 1>a||a>f?void(b&&d.fire("error",["输入的页码值只能从 1 到 "+f])):(c.last=c.current,c.current=a,this.render(),void(b&&d.fire("change",[a])))},previous:function(a){var b=k.get(this);this.to(b.current-1,a)},next:function(a){var b=k.get(this);this.to(b.current+1,a)},first:function(a){this.to(1,a)},"final":function(a){var b=k.get(this);this.to(b.count,a)},refresh:function(a){var b=k.get(this);this.to(b.current,a)},on:function(){var a=k.get(this),b=a.emitter,c=[].slice.call(arguments,0);b.on.apply(b,c)},destroy:function(){var a=k.get(this);a.emitter.off();var b=a.container;h(b).html("").undelegate(),k.remove(this)}},h.Object.extend(g,{create:function(a){var b=new g(a);return b.render(),b}})}),B("Pagers",function(a){function b(a){var b=a.container,c=new e(f({},a,{container:b.simple}));c.on("change",function(a){g.to(a)});var g=new d(f({},a,{container:b.normal}));return g.on("change",function(a){c.to(a)}),c.render(),g.render(),[c,g]}var c=a("$"),d=a("Pager"),e=a("SimplePager"),f=c.Object.extend;return{create:b}}),B("Samples",function(a){function c(a){return a.replace(/\n/g,"").replace(/\s{2,}/g," ")}function d(a,b){var d="<!--Samples."+a+"--!",g="--Samples."+a+"-->",h=e.String.between(f,d,g);return b?(e.Array.each(b,function(a){if(a.trim){delete a.trim;var b=a.fn;a.fn=b?function(a){return a=b(a),a=c(a)}:c}}),e.String.getTemplates(h,b)):h}var e=a("$"),f=b.document.body.innerHTML;return{get:d}}),B("SimplePager",function(a){function b(a){function b(a){var b=+a.value;b!=r.current?s.to(b,!0):s.render()}var e=c.String.random().toLowerCase(),f="-simple-pager-"+e;this[h]="SimplePager-"+e;var i=a.container||j.container,k=a.current||j.current,l=a.size||j.size,m=a.total,n=u.ceil(m/l),o="ul"+f,p="txt"+f,q=new d.Event(this),r={ulId:o,txtId:p,container:i,current:k,size:l,count:n,hideIfLessThen:a.hideIfLessThen||j.hideIfLessThen,emitter:q};g.set(this,r);var s=this;c.Array.each(["change","error"],function(b){var c=a[b];c&&s.on(b,c)});var t="#"+o+" [data-button]:not(.disabled)";c(i).delegate(t,"click",function(){var a=this,b=a.getAttribute("data-button");s[b](!0)}),c(i).delegate("#"+p,{focusin:function(){var a=this;a.value=r.current},focusout:function(){b(this)},keydown:function(a){13==a.keyCode&&b(this)}})}var c=a("$"),d=a("MiniQuery"),e=d.require("Mapper"),f=a("Samples"),g=new e,h=e.getGuidKey(),i=f.get("SimplePager"),j={};return b.prototype={constructor:b,render:function(){var a=g.get(this),b=a.container,d=a.count;if(d<a.hideIfLessThen)return void c(b).hide();var e=u.min(d,a.current),f=c.String.format(i,{"ul-id":a.ulId,"txt-id":a.txtId,current:e,count:d,"first-disabled-class":e==u.min(1,d)?"disabled":"","final-disabled-class":e==d?"disabled":""});c(b).html(f).show()},to:function(a,b){var c=g.get(this),d=c.emitter,e=/^\d+$/.test(a);if(!e)return b&&d.fire("error",["输入的页码必须是大于 0 的数字"]),!1;a=parseInt(a);var f=c.count;return 1>a||a>f?(b&&d.fire("error",["输入的页码值只能从 1 到 "+f]),!1):(c.current=a,this.render(),b&&d.fire("change",[a]),!0)},focus:function(){var a=g.get(this);c(a.container).find("input").get(0).focus()},previous:function(a){var b=g.get(this);this.to(b.current-1,a)},next:function(a){var b=g.get(this);this.to(b.current+1,a)},first:function(a){this.to(1,a)},"final":function(a){var b=g.get(this);this.to(b.count,a)},refresh:function(a){var b=g.get(this);this.to(b.current,a)},on:function(){var a=g.get(this),b=a.emitter,c=[].slice.call(arguments,0);b.on.apply(b,c)},destroy:function(){var a=g.get(this);a.emitter.off();var b=a.container;c(b).html("").undelegate(),g.remove(this)}},c.Object.extend(b,{create:function(a){var c=new b(a);return c.render(),c},config:function(a){c.Object.extend(j,a)}})}),B("Tabs",function(a){function b(a){var b=this;this[h]="Tabs-"+c.String.random();var d=a.container,e=a.selector,i=a.activedClass,j=a.event,k=new f(this),l={container:d,selector:e,activedClass:i,eventName:j,activedIndex:-1,emitter:k};g.set(this,l),j&&c(d).delegate(e,j,function(){var f,g=this;if("indexKey"in a)f=+g.getAttribute(a.indexKey);else{var h=c(d).find(e).toArray();f=c.Array.findIndex(h,function(a){return a===g})}k.fire("event",[f,g]),b.active(f,!0)});var m=a.change;m&&this.on("change",m);var n=a.current;"number"==typeof n&&n>=0&&this.active(n,!0)}var c=a("$"),d=a("MiniQuery"),e=d.require("Mapper"),f=d.require("Emitter"),g=new e,h=e.getGuidKey();return b.prototype={constructor:b,active:function(a,b){var d=g.get(this),e=d.activedIndex;if(a!=e||!b){this.reset(),d.activedIndex=a;var f=d.activedClass,h=c(d.container).find(d.selector).toArray(),i=h[a];c(i).addClass(f),b&&d.emitter.fire("change",[a,i])}},reset:function(){var a=g.get(this);c(a.container).find(a.selector).removeClass(a.activedClass),a.activedIndex=-1},remove:function(a){var b=g.get(this),c=b.activedIndex;return a==c?void this.reset():(c>a&&c--,void this.active(c,!1))},destroy:function(){var a=g.get(this),b=a.eventName;b&&c(a.container).undelegate(a.selector,b),a.emitter.off(),g.remove(this)},on:function(){var a=g.get(this),b=a.emitter,c=[].slice.call(arguments,0);b.on.apply(b,c)},getActivedIndex:function(){var a=g.get(this);return a.activedIndex}},c.Object.extend(b,{create:function(a){return new b(a)}})}),B("Template",function(a){function b(a,g,h){if(d.Object.isPlain(a))return h=g,void d.Object.each(a,function(a,c){b(a,c,h)});if("string"==typeof a){var i=a;0==i.indexOf("#")&&(i=i.slice(1)),a=e.getElementById(i)}var j=c(a);a.innerHTML=g instanceof p?d.Array.keep(g,function(a,b){return h&&(a=h(a,b)),f(j,a)}).join(""):f(j,g)}function c(a){var b;"string"==typeof a?(b=a,0==b.indexOf("#")&&(b=b.slice(1)),a=e.getElementById(b)):(b=a.id,b||(b=a.getAttribute(h),b||(b=a.tagName.toLowerCase()+"-"+d.String.random(),a.setAttribute(h,b))));var c=g[b];return c||(c=d.String.between(a.innerHTML,"<!--","-->"),g[b]=c),c}var d=a("$"),f=d.String.format,g={},h="data-template-id-"+d.String.random(4).toLowerCase();return{fill:b,get:c}}),B("Tips",function(){function a(a,e,f,g){function h(){var c=b.KERP.require("Tips");a?c.add(d,a,e):c.open(d)}if("object"==typeof e&&e){var i=e;e=i.text,f=i.duration,g=i.delay}clearTimeout(l),clearTimeout(m),g?m=k(h,g):h(),f&&(l=k(c,f))}function c(){clearTimeout(l),clearTimeout(m),b.KERP.require("Tips").close(d)}function e(b,c,d){a("success",b,c,d)}function f(b,c,d){a("info",b,c,d)}function g(b,c,d){a("warn",b,c,d)}function h(b,c,d){a("error",b,c,d)}function i(b,c,d){a("loading",b,c,d)}function j(){clearTimeout(m)}var l,m;return{show:a,hide:c,success:e,info:f,warn:g,error:h,loading:i,cancel:j,add:function(a,b,c){alert(b+":"+c)},open:function(){},close:function(){}}}),o.use("$"),A.expose({Module:!0,Cache:!0,Debug:!0,File:!0,Url:!0,Multitask:!0,Tree:!0,Seajs:!0,Proxy:!0,API:!0,Iframe:!0,IframeManager:!1,ButtonList:!0,CascadeMenus:!1,CascadeNavigator:!0,CascadePath:!1,CascadePicker:!0,Dialog:!0,Loading:!0,Login:!0,Pager:!0,SimplePager:!0,Tabs:!0,Template:!0,Tips:!0,Pagers:!0,NumberField:!0,DateTimePicker:!0});var D={require:function(a){return A.expose(a)?A.require(a):null},use:function(a,b){var c=D.require(a);if(!c)return void(b&&b(null));var d=c.use;d?d(b):b&&b(c)},config:C("Config").set,Cache:C("Cache"),Debug:C("Debug"),File:C("File"),Url:C("Url"),Proxy:C("Proxy"),API:C("API"),Pages:C("Pages"),CascadePicker:C("CascadePicker"),Dialog:C("Dialog"),Loading:C("Loading"),Login:C("Login"),Pager:C("Pager"),SimplePager:C("SimplePager"),Tabs:C("Tabs"),Template:C("Template"),Tips:C("Tips"),Pagers:C("Pagers")};"function"==typeof a.define&&(a.define.cmd||a.define.amd)?a.define(function(){return D}):a.KERP=D}(this,top,parent,window,document,location,localStorage,sessionStorage,console,history,setTimeout,setInterval,KISP.require("$"),KISP.require("$"),KISP.require("MiniQuery"),Array,Boolean,Date,Error,Function,Math,Number,Object,RegExp,String);